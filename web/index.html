<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Synthelligence</title>
</head>

<body>
  <div class="page">
    <div class="container">
      <div class="col">
        <div class="wrapper">
          <canvas id="haathi_canvas" width="1280" height="720" style="background: #ccc;"></canvas>
        </div>
      </div>
    </div>
  </div>
  <script src="haathi.js"></script>

  <script>
    const env = { ...api };
    document.addEventListener('contextmenu', event => event.preventDefault());

    fetchAndInstantiate('synthelligence.wasm', { env }).then(instance => {
      memory = instance.exports.memory;
      console.log(instance);
      instance.exports.init();
      const zig_render = instance.exports.render;
      document.addEventListener('keydown', e => instance.exports.key_down(getKeycode(e.key)));
      document.addEventListener('keyup', e => instance.exports.key_up(getKeycode(e.key)));
      document.addEventListener('mousedown', e => instance.exports.mouse_down(e.button));
      document.addEventListener('mouseup', e => instance.exports.mouse_up(e.button));
      document.addEventListener('mousemove', e => instance.exports.mouse_motion(e.x, e.y));

      function render() {
        zig_render();
        window.requestAnimationFrame(render);
      }
      window.requestAnimationFrame(render);
    });

    function fetchAndInstantiate(url, importObject) {
      return fetch(url)
        .then(response => response.arrayBuffer())
        .then(bytes => WebAssembly.instantiate(bytes, importObject))
        .then(results => results.instance);
    }

  </script>

  <style>
    body {
      padding: 0;
      margin: 0;
    }
    html {
      padding: 0;
      margin: 0;
    }
  </style>

</body>

</html>
